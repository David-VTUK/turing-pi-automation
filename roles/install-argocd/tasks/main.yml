- name: Add ArgoCD repository
  kubernetes.core.helm_repository:
    name: argo
    repo_url: https://argoproj.github.io/argo-helm

- name: Install ArgoCD helm chart
  kubernetes.core.helm:
    name: argocd
    chart_ref: argo/argo-cd
    chart_version: "{{ argo_cd_version }}"
    create_namespace: true
    release_namespace: "{{ argo_cd_namespace }}"
    values:
      global:
        domain: "{{ argo_cd_url }}"
      configs:
        params:
          server.insecure: true
